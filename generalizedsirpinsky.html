<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Newton approximation</title>
    <script src="modernizr.js"></script>
    <script type="text/javascript">
        window.addEventListener("load", eventWindowLoaded, false);

        function eventWindowLoaded() {
            canvasApp();
        }

        function canvasSupport() {
            return Modernizr.canvas;
        }

        function canvasApp() {
            if (!canvasSupport()) {
                return;
            }

            var theCanvas = document.getElementById("canvasOne");
            var context = theCanvas.getContext("2d");

            function drawBase(size) {
                context.strokeStyle = "#FFFFFF";

                context.beginPath();
                context.moveTo(0 + 0.5, size + 0.5);
                context.lineTo(size / 2 + 0.5, 0.5);
                context.stroke();

                context.beginPath();
                context.moveTo(0 - 0.5, size - 0.5);
                context.lineTo(size - 0.5, size - 0.5);
                context.stroke();

                context.beginPath();
                context.moveTo(size / 2 + 0.5, 0.5);
                context.lineTo(size - 0.5, size - 0.5);
                context.stroke();

                return [{x: 0, y: 0, size: size}];
            }

            function drawRecursive(x, y, size) {
                context.strokeStyle = "#FFFFFF";

                context.beginPath();
                context.moveTo(x + size/2 + 0.5, y + size + 0.5);
                context.lineTo(x + size/4 + 0.5, y + size/2 + 0.5);
                context.stroke();

                context.beginPath();
                context.moveTo(x + size/2 + 0.5, y + size + 0.5);
                context.lineTo(x + 3*size/4 + 0.5, y + size/2 + 0.5);
                context.stroke();

                context.beginPath();
                context.moveTo(x + size/4 + 0.5, y + size/2 + 0.5);
                context.lineTo(x + 3*size/4 + 0.5, y + size/2 + 0.5);
                context.stroke();

                if (size < 50) {
                    return [];
                }
                return [
                    {x: x + size / 4, y: y, size: size / 2},
                    {x: x, y: y + size / 2, size: size / 2},
                    {x: x + size / 2, y: y + size / 2, size: size / 2},
                ];
            }

            function drawScreen() {
                // We're in space so make the whole canvas black.
                context.fillStyle = "#000000";
                context.fillRect(0, 0, theCanvas.width, theCanvas.height);

                squares = drawBase(theCanvas.width);

                while (squares.length > 0) {
                    nextsquares = [];
                    for (var i = 0; i < squares.length; i++) {
                        if (squares[i].size >= 1) {
                            nextsquares = nextsquares.concat(
                                drawRecursive(squares[i].x, squares[i].y, squares[i].size)
                            );
                        }
                    }
                    squares = nextsquares;
                }

            }


            function gameLoop() {
                // setTimeout(gameLoop, 20);
                drawScreen();
            }

            gameLoop();
        }

    </script>
</head>
<body style="background-color: black;">
    <canvas id="canvasOne" width="512" height="512">
        Your browser does not support HTML5 canvas.
    </canvas>
</body>
