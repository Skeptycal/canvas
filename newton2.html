<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Newton approximation</title>
    <script src="modernizr.js"></script>
    <script type="text/javascript">
        window.addEventListener("load", eventWindowLoaded, false);

        function eventWindowLoaded() {
            canvasApp();
        }

        function canvasSupport() {
            return Modernizr.canvas;
        }

        function canvasApp() {
            if (!canvasSupport()) {
                return;
            }

            var theCanvas = document.getElementById("canvasOne");
            var context = theCanvas.getContext("2d");

            // There will be two bodies: The "sun" and the "earth".

            var objects = [
                // Sun
                {
                    x: 900000000000,
                    y: 900000000000,
                    radius: 20,
                    vx: 0,
                    vy: 0,
                    mass: 1.989e30,
                    color: 'yellow',
                },
                // Earth
                {
                    x: 900000000000 + 1.496e11,
                    y: 900000000000,
                    radius: 5,
                    vx: 0,
                    vy: -29805.6,
                    mass: 5.972e24,
                    color: 'blue',
                },
                // Jupiter
                {
                    x: 900000000000 + 778547200*1000,
                    y: 900000000000,
                    radius: 15,
                    vx: 0,
                    vy: -13070.0,
                    mass: 1.8986e27,
                    color: 'brown',
                },
            ];

            // This is the amount of time we progress in each iteration. 
            // The smaller this value, the more "accurate" the simulation will be.
            var epsilon = 500000;

            var G = 6.67e-11;

            function drawScreen() {

                // We're in space so make the whole canvas black.
                context.fillStyle = "#000000";
                context.fillRect(0, 0, theCanvas.width, theCanvas.height);

                // The way we progress in the simulation is to compute the next
                // position and velocity of the objects given their current
                // velocity and acceleration. This is, of course, not 100%
                // accurate, but gives a good approximation when epsilon is
                // small.

                var i;
                var j;
                
                for (i = 0; i < objects.length; i++) {
                    objects[i].x = objects[i].x + epsilon * objects[i].vx;
                    objects[i].y = objects[i].y + epsilon * objects[i].vy;
                }

                for (i = 0; i < objects.length; i++) {
                    var F_x = 0;
                    var F_y = 0;
                    for (j = 0; j < objects.length; j++) {
                        if (j == i) continue;
                        var distance_x = objects[i].x - objects[j].x;
                        var distance_y = objects[i].y - objects[j].y;
                        var r = Math.sqrt(distance_x*distance_x + distance_y*distance_y);
                        F_x -= G * objects[i].mass * objects[j].mass * distance_x / (r*r*r);
                        F_y -= G * objects[i].mass * objects[j].mass * distance_y / (r*r*r);
                    }
                    var A_x = F_x / objects[i].mass;
                    var A_y = F_y / objects[i].mass;
                    objects[i].vx = objects[i].vx + epsilon * A_x;
                    objects[i].vy = objects[i].vy + epsilon * A_y;
                }


                for (i = 0; i < objects.length; i++) {
                    context.beginPath();
                    context.arc(objects[i].x/3000000000, objects[i].y/3000000000, objects[i].radius, 0, 2*Math.PI, false);
                    context.fillStyle = objects[i].color;
                    context.fill();
                }
            }


            function gameLoop() {
                setTimeout(gameLoop, 20);
                drawScreen();
            }

            gameLoop();
        }

    </script>
</head>
<body>
    <p>
    In the <a href="http://www.feynmanlectures.caltech.edu/I_09.html">ninth
        lecture from the Feynman Lectures on Physics</a>, Feynman describes
    Newton's first two laws of motion. Near the end of the lecture, he describes
    how we can compute the orbit of a planet given just newton's laws. At the
    time, this was done done manually, and was computed using a large table.
    After reading it, I <em>had</em> to implement it in a computer. This
    animation is the result. Call the yellow circle the "sun" and the blue
    circle the "earth." It assumes the earth is affected by the sun's gravity,
    but the sun is not affected by the earth, and shows how the orbit forms an
    ellipse. Read the source code for more details.
    </p>
    <canvas id="canvasOne" width="1500" height="800" style="border: solid white 1px;">
        Your browser does not support HTML5 canvas.
    </canvas>
</body>
